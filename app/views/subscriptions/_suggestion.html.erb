<div id="suggestion_<%= suggestion.id %>" class="p-4 flex items-center justify-between gap-4 hover:bg-surface-hover transition-colors">
  <div class="flex items-center gap-3 flex-1 min-w-0">
    <%# Logo with fallback for broken images %>
    <div class="relative w-10 h-10 flex-shrink-0">
      <% logo_url = suggestion.subscription_service&.logo_url || suggestion.merchant&.logo_url %>
      <% if logo_url.present? %>
        <%= image_tag logo_url,
            class: "w-10 h-10 rounded-full object-cover",
            loading: "lazy",
            onerror: "this.style.display='none'; this.nextElementSibling.style.display='flex';" %>
        <div style="display: none;">
          <%= render DS::FilledIcon.new(
            variant: :text,
            text: suggestion.display_name,
            size: "lg",
            rounded: true
          ) %>
        </div>
      <% else %>
        <%= render DS::FilledIcon.new(
          variant: :text,
          text: suggestion.display_name,
          size: "lg",
          rounded: true
        ) %>
      <% end %>
    </div>

    <%# Details %>
    <div class="min-w-0 flex-1">
      <div class="flex items-center gap-2">
        <span class="text-sm text-primary font-medium truncate"><%= suggestion.display_name %></span>
        <% if suggestion.subscription_service.present? %>
          <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-50 text-success">
            Matched
          </span>
        <% end %>
      </div>
      <div class="flex items-center flex-wrap gap-x-3 gap-y-1 text-xs text-secondary mt-0.5">
        <% if suggestion.detected_base_currency.present? && suggestion.detected_base_amount.present? %>
          <span class="font-medium text-primary">
            $<%= number_with_precision(suggestion.detected_base_amount, precision: 2) %> <%= suggestion.detected_base_currency %>/<%= suggestion.billing_cycle_yearly? ? "yr" : "mo" %>
          </span>
          <span class="text-secondary">
            (<%= format_money(-suggestion.amount_money) %> local)
          </span>
        <% else %>
          <span class="font-medium text-primary">
            <%= format_money(-suggestion.amount_money) %>/<%= suggestion.billing_cycle_yearly? ? "yr" : "mo" %>
          </span>
        <% end %>
        <% if suggestion.occurrence_count.present? && suggestion.occurrence_count.to_i > 0 %>
          <span><%= t("subscriptions.suggestions.transaction_count", count: suggestion.occurrence_count.to_i) %></span>
        <% end %>
        <% if suggestion.inferred_account.present? %>
          <span class="flex items-center gap-1">
            <%= icon "wallet", size: "xs" %>
            <%= suggestion.inferred_account.name %>
          </span>
        <% end %>
      </div>
    </div>
  </div>

  <%# Actions - consistent button styling for both dropdown and simple cases %>
  <% approve_btn_classes = "inline-flex items-center gap-1.5 w-full px-3 py-1.5 text-sm font-medium text-success hover:bg-green-50 dark:hover:bg-green-950 rounded-lg transition-colors" %>
  <div class="flex items-center gap-1 flex-shrink-0">
    <%# Fixed-width wrapper ensures alignment regardless of button type %>
    <div class="w-[115px]">
      <% if suggestion.detected_base_currency.present? && suggestion.detected_base_amount.present? %>
        <%# Dropdown with currency options %>
        <%= render DS::Menu.new(variant: :button, placement: "bottom-end") do |menu| %>
          <% menu.with_button(type: "button", class: approve_btn_classes) do %>
            <%= icon "check", size: "sm", color: "current" %>
            <span><%= t("subscriptions.suggestions.approve") %></span>
            <%= icon "chevron-down", size: "xs", color: "current", class: "ml-0.5 opacity-60" %>
          <% end %>
          <% menu.with_item(
            variant: "button",
            text: t("subscriptions.suggestions.approve_usd_option", currency: suggestion.detected_base_currency.upcase),
            icon: "check",
            href: approve_suggestion_subscription_path(suggestion, use_base_currency: "1"),
            method: :post
          ) %>
          <% menu.with_item(
            variant: "button",
            text: t("subscriptions.suggestions.approve_local_option"),
            icon: "coins",
            href: approve_suggestion_subscription_path(suggestion),
            method: :post
          ) %>
        <% end %>
      <% else %>
        <%# Simple approve button %>
        <%= button_to approve_suggestion_subscription_path(suggestion), method: :post, class: approve_btn_classes do %>
          <%= icon "check", size: "sm", color: "current" %>
          <span><%= t("subscriptions.suggestions.approve") %></span>
        <% end %>
      <% end %>
    </div>

    <%# Icon-only dismiss button %>
    <%= button_to dismiss_suggestion_subscription_path(suggestion), method: :post,
        class: "inline-flex items-center justify-center w-8 h-8 text-secondary hover:text-destructive hover:bg-red-50 dark:hover:bg-red-950 rounded-lg transition-colors",
        title: t("subscriptions.suggestions.dismiss") do %>
      <%= icon "x", size: "sm", color: "current" %>
    <% end %>
  </div>
</div>
