<%# locals: (subscription:) %>

<%= styled_form_with model: subscription, url: subscription.persisted? ? subscription_path(subscription) : subscriptions_path, class: "space-y-6" do |f| %>
  <% if subscription.errors.any? %>
    <%= render "shared/form_errors", model: subscription %>
  <% end %>

  <%# Name %>
  <div class="space-y-2">
    <%= f.text_field :name,
        label: t("subscriptions.form.name"),
        placeholder: t("subscriptions.form.name_placeholder"),
        required: true,
        autofocus: true %>
  </div>

  <%# Amount and Currency %>
  <div class="grid grid-cols-2 gap-4">
    <div class="space-y-2">
      <%= f.number_field :amount,
          label: t("subscriptions.form.amount"),
          step: 0.01,
          min: 0,
          required: true,
          value: subscription.amount.present? ? subscription.amount.abs : nil %>
    </div>
    <div class="space-y-2">
      <%= f.select :currency,
          Money::Currency.as_options.map { |c| [c.iso_code, c.iso_code] },
          { label: t("subscriptions.form.currency"), selected: subscription.currency || Current.family.currency },
          required: true %>
    </div>
  </div>

  <%# Billing Cycle and Day %>
  <div class="grid grid-cols-2 gap-4">
    <div class="space-y-2">
      <%= f.select :billing_cycle,
          [
            [t("subscriptions.billing_cycle.monthly"), "monthly"],
            [t("subscriptions.billing_cycle.yearly"), "yearly"]
          ],
          { label: t("subscriptions.form.billing_cycle") },
          required: true %>
    </div>
    <div class="space-y-2">
      <%= f.number_field :expected_day_of_month,
          label: t("subscriptions.form.billing_day"),
          min: 1,
          max: 31,
          required: true %>
      <p class="text-xs text-subdued"><%= t("subscriptions.form.billing_day_hint") %></p>
    </div>
  </div>

  <%# Category %>
  <div class="space-y-2">
    <%= f.select :category_id,
        Category.grouped_select_options(Current.family.categories.expenses.roots.alphabetically),
        { include_blank: t("subscriptions.form.category_placeholder"), label: t("subscriptions.form.category") } %>
  </div>

  <%# Merchant %>
  <div class="space-y-2">
    <%= f.select :merchant_id,
        Current.family.merchants.order(:name).map { |m| [m.name, m.id] },
        { include_blank: t("subscriptions.form.merchant_placeholder"), label: t("subscriptions.form.merchant") } %>
  </div>

  <%# Custom Logo URL %>
  <div class="space-y-2">
    <%= f.text_field :custom_logo_url,
        label: t("subscriptions.form.logo"),
        placeholder: "https://example.com/logo.png" %>
    <p class="text-xs text-subdued"><%= t("subscriptions.form.logo_hint") %></p>
  </div>

  <%# Notes %>
  <div class="space-y-2">
    <%= f.text_area :notes,
        label: t("subscriptions.form.notes"),
        placeholder: t("subscriptions.form.notes_placeholder"),
        rows: 3 %>
  </div>

  <%# Actions %>
  <div class="flex items-center gap-3 pt-4 border-t border-divider">
    <%= f.submit t("subscriptions.form.save"), class: "btn btn--primary" %>
    <%= link_to t("subscriptions.form.cancel"), subscriptions_path, class: "btn btn--outline" %>
  </div>
<% end %>
